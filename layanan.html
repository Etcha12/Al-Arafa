<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Layanan - LRC AL-ARAFA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Custom Colors */
        .bg-primary { background-color: #1A2C5B; }
        .text-primary { color: #1A2C5B; }
        .border-primary { border-color: #1A2C5B; }
        .bg-accent { background-color: #0A4740; }
        .text-accent { color: #0A4740; }
        .hover\:bg-accent-dark:hover { background-color: #07332E; }
        .bg-secondary { background-color: #F8F8F8; }
        .text-dark-gray { color: #333333; }
        .text-medium-gray { color: #666666; }

        /* Gradient Text for emphasis */
        .gradient-text {
            background: linear-gradient(45deg, #1A2C5B, #0A4740);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        /* Smooth scroll */
        html { scroll-behavior: smooth; }

        /* Card Hover Effect */
        .card-hover-effect {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card-hover-effect:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        /* Modal Styling */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 100; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.6); /* Black w/ opacity */
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            width: 90%;
            max-width: 600px;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }
        .close-button {
            color: #aaa;
            position: absolute;
            top: 15px;
            right: 25px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close-button:hover,
        .close-button:focus {
            color: #333;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>
<body class="font-sans text-dark-gray bg-secondary">

    <!-- Header -->
    <header class="bg-primary text-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <h1 class="text-3xl font-bold">LRC AL-ARAFA</h1>
            </div>
            
            <nav class="hidden md:flex items-center space-x-8">
                <a href="index.html" class="text-lg font-medium hover:text-gray-300 transition duration-300">Home</a>
                <a href="fasilitas.html" class="text-lg font-medium hover:text-gray-300 transition duration-300">Fasilitas</a>
                <a href="program.html" class="text-lg font-medium hover:text-gray-300 transition duration-300">Program</a>
                <a href="layanan.html" class="text-lg font-medium hover:text-gray-300 transition duration-300">Layanan</a>
                <a href="tentang.html" class="text-lg font-medium hover:text-gray-300 transition duration-300">Tentang Kami</a>
                <a href="kontak.html" class="text-lg font-medium hover:text-gray-300 transition duration-300">Kontak</a>
            </nav>

            <div id="authArea" class="flex items-center space-x-4">
                <button id="loginButton" onclick="window.location.href='login.html'" class="bg-accent text-white px-6 py-2 rounded-full text-lg font-semibold shadow-md hover:bg-accent-dark transition duration-300 transform hover:scale-105">
                    <i class="fas fa-sign-in-alt mr-2"></i>Masuk
                </button>
                <div id="welcomeArea" class="hidden items-center space-x-2">
                    <button id="welcomeButton" class="bg-white text-primary px-4 py-2 rounded-full text-lg font-semibold cursor-default shadow-md">
                        <i class="fas fa-user-circle mr-2"></i><span id="welcomeMessage"></span>
                    </button>
                    <button id="logoutButton" onclick="logout()" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded-full text-sm font-semibold shadow-md">Keluar</button>
                </div>
            </div>

            <!-- Mobile Menu Button (Hamburger) -->
            <button id="mobileMenuButton" class="md:hidden text-white text-2xl focus:outline-none">
                <i class="fas fa-bars"></i>
            </button>
        </div>

        <!-- Mobile Menu Overlay -->
        <div id="mobileMenu" class="hidden md:hidden fixed inset-0 bg-primary bg-opacity-95 z-40 flex flex-col items-center justify-center space-y-6 text-2xl">
            <button id="closeMobileMenuButton" class="absolute top-6 right-6 text-white text-3xl focus:outline-none">
                <i class="fas fa-times"></i>
            </button>
            <a href="index.html" class="text-white hover:text-gray-300 transition duration-300">Home</a>
            <a href="fasilitas.html" class="text-white hover:text-gray-300 transition duration-300">Fasilitas</a>
            <a href="program.html" class="text-white hover:text-gray-300 transition duration-300">Program</a>
            <a href="layanan.html" class="text-white hover:text-gray-300 transition duration-300">Layanan</a>
            <a href="tentang.html" class="text-white hover:text-gray-300 transition duration-300">Tentang Kami</a>
            <a href="kontak.html" class="text-white hover:text-gray-300 transition duration-300">Kontak</a>
            <button onclick="window.location.href='login.html'" class="bg-accent text-white px-6 py-2 rounded-full text-lg font-semibold shadow-md hover:bg-accent-dark transition duration-300 transform hover:scale-105 mt-8">
                <i class="fas fa-sign-in-alt mr-2"></i>Masuk
            </button>
        </div>
    </header>

    <!-- Main Content - Layanan -->
    <main class="py-20">
        <div class="max-w-6xl mx-auto px-6 text-center">
            <h2 class="text-4xl font-bold gradient-text inline-block mb-12">Layanan Kami</h2>
            <p class="text-lg text-medium-gray max-w-3xl mx-auto mb-16">
                LRC AL-ARAFA menyediakan berbagai layanan untuk mendukung kebutuhan belajar dan pengembangan diri Anda. Silakan pilih layanan di bawah ini:
            </p>
            
            <div class="grid md:grid-cols-3 gap-10">
                <!-- Layanan: Pinjam Ruangan -->
                <div class="bg-white p-8 rounded-xl shadow-lg border border-gray-200 card-hover-effect">
                    <div class="text-primary text-5xl mb-6">
                        <i class="fas fa-chalkboard-teacher"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-primary mb-4">Pinjam Ruangan</h3>
                    <p class="text-medium-gray mb-6">
                        Pesan ruang produksi video, podcast, auditorium, atau ruang diskusi untuk berbagai kebutuhan acara dan kreasi Anda.
                    </p>
                    <button onclick="handleServiceClick('pinjamRuangan')" class="inline-flex items-center text-accent hover:text-primary font-semibold transition duration-300">
                        Ajukan Peminjaman <i class="fas fa-arrow-right ml-2"></i>
                    </button>
                </div>

                <!-- Layanan: Pinjam Buku -->
                <div class="bg-white p-8 rounded-xl shadow-lg border border-gray-200 card-hover-effect">
                    <div class="text-primary text-5xl mb-6">
                        <i class="fas fa-book-open"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-primary mb-4">Pinjam Buku</h3>
                    <p class="text-medium-gray mb-6">
                        Akses koleksi buku, jurnal, dan sumber daya digital kami. Tingkatkan pengetahuan Anda dengan beragam topik yang tersedia.
                    </p>
                    <button onclick="handleServiceClick('pinjamBuku')" class="inline-flex items-center text-accent hover:text-primary font-semibold transition duration-300">
                        Lihat Koleksi <i class="fas fa-arrow-right ml-2"></i>
                    </button>
                </div>

                <!-- Layanan: Daftar Pelatihan -->
                <div class="bg-white p-8 rounded-xl shadow-lg border border-gray-200 card-hover-effect">
                    <div class="text-primary text-5xl mb-6">
                        <i class="fas fa-laptop-code"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-primary mb-4">Daftar Pelatihan</h3>
                    <p class="text-medium-gray mb-6">
                        Ikuti berbagai pelatihan keterampilan digital dan hidup yang relevan untuk meningkatkan kompetensi dan peluang Anda.
                    </p>
                    <button onclick="handleServiceClick('daftarPelatihan')" class="inline-flex items-center text-accent hover:text-primary font-semibold transition duration-300">
                        Jadwal Pelatihan <i class="fas fa-arrow-right ml-2"></i>
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Modals -->
    <!-- Not Logged In Modal -->
    <div id="notLoggedInModal" class="modal">
        <div class="modal-content text-center">
            <span class="close-button" onclick="closeNotLoggedInModal()">&times;</span>
            <i class="fas fa-info-circle text-5xl text-primary mb-6"></i>
            <h2 class="text-2xl font-bold text-dark-gray mb-4">Akses Dibatasi</h2>
            <p class="text-medium-gray mb-6">Anda perlu **login** terlebih dahulu untuk mengakses fitur ini.</p>
            <button onclick="goToLoginFromNotification()" class="bg-primary hover:bg-accent-dark text-white px-6 py-2 rounded-full font-semibold">
                Login Sekarang
            </button>
        </div>
    </div>

    <!-- Service Modal (for forms and details) -->
    <div id="serviceModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeServiceModal()">&times;</span>
            <h2 id="serviceModalTitle" class="text-3xl font-bold text-center gradient-text mb-8"></h2>
            <div id="serviceModalContent" class="text-medium-gray">
                <!-- Content will be injected here by JS -->
            </div>
            <div id="serviceModalForm" class="mt-8">
                <h3 class="text-xl font-bold text-primary mb-4">Form Pengajuan</h3>
                <form id="serviceSubmissionForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-dark-gray">Nama Lengkap</label>
                        <input type="text" id="formName" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm" required readonly />
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-dark-gray">Nomor Anggota</label>
                        <input type="text" id="formMemberId" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm" required readonly />
                    </div>
                    <div id="additionalServiceFormFields">
                        <!-- Additional fields based on service type will be injected here -->
                    </div>
                    <button type="submit" class="w-full bg-accent hover:bg-accent-dark text-white font-semibold py-3 rounded-full transition duration-300">Kirim Permohonan</button>
                </form>
            </div>
            <div id="confirmationMessage" class="hidden mt-8 p-4 bg-green-100 border border-green-300 text-green-800 rounded-lg text-center">
                <i class="fas fa-check-circle text-3xl mb-3"></i>
                <p class="font-semibold text-lg">Permohonan Anda berhasil diajukan!</p>
                <p id="confirmationDetail" class="mt-2 text-sm"></p>
                <button onclick="closeServiceModal()" class="mt-4 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-full">Tutup</button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark-gray text-white py-12">
        <div class="max-w-7xl mx-auto px-6 grid grid-cols-1 md:grid-cols-4 gap-8">
            <div>
                <h3 class="text-2xl font-bold mb-4">LRC AL-ARAFA</h3>
                <p class="text-gray-300 text-sm">Pusat Sumber Belajar terdepan untuk mendukung budaya belajar mandiri, inovatif, dan kolaboratif.</p>
            </div>
            <div>
                <h4 class="text-xl font-semibold mb-4">Tautan Cepat</h4>
                <ul class="space-y-2">
                    <li><a href="index.html" class="text-gray-300 hover:text-white transition">Home</a></li>
                    <li><a href="fasilitas.html" class="text-gray-300 hover:text-white transition">Fasilitas</a></li>
                    <li><a href="program.html" class="text-gray-300 hover:text-white transition">Program</a></li>
                    <li><a href="layanan.html" class="text-gray-300 hover:text-white transition">Layanan</a></li>
                    <li><a href="tentang.html" class="text-gray-300 hover:text-white transition">Tentang Kami</a></li>
                    <li><a href="kontak.html" class="text-gray-300 hover:text-white transition">Kontak</a></li>
                </ul>
            </div>
            <div>
                <h4 class="text-xl font-semibold mb-4">Kontak Kami</h4>
                <ul class="space-y-3 text-gray-300">
                    <li class="flex items-start">
                        <i class="fas fa-map-marker-alt mt-1 mr-3"></i>
                        <span>Jl. Pendidikan No. 123, Kampus Utama, Kota Edukasi</span>
                    </li>
                    <li class="flex items-center">
                        <i class="fas fa-phone-alt mr-3"></i>
                        <span>(021) 123-4567</span>
                    </li>
                    <li class="flex items-center">
                        <i class="fas fa-envelope mr-3"></i>
                        <span>info@lrc-alarafa.ac.id</span>
                    </li>
                </ul>
            </div>
            <div>
                <h4 class="text-xl font-semibold mb-4">Ikuti Kami</h4>
                <div class="flex space-x-4">
                    <a href="#" class="text-gray-300 hover:text-white text-2xl"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" class="text-gray-300 hover:text-white text-2xl"><i class="fab fa-twitter"></i></a>
                    <a href="#" class="text-gray-300 hover:text-white text-2xl"><i class="fab fa-instagram"></i></a>
                    <a href="#" class="text-gray-300 hover:text-white text-2xl"><i class="fab fa-youtube"></i></a>
                </div>
            </div>
        </div>
        <div class="border-t border-gray-700 mt-8 pt-6 text-center text-gray-400 text-sm">
            <p>Â© 2025 LRC AL-ARAFA. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // Dummy Accounts (as per request)
        const dummyAccounts = [
            { memberId: "030410", username: "Fachriza", password: "Cupcake" },
            { memberId: "030411", username: "Akmal", password: "Hujan" },
            { memberId: "030412", username: "Rangga", password: "Kelinci" },
            { memberId: "030500", username: "Alif", password: "Lolipop" },
            { memberId: "030350", username: "Ali", password: "Daun" },
            { memberId: "admin", username: "Khaerudin", password: "admin123" } 
        ];

        // Dummy data for books with availability (Max 20 books)
        const dummyBooks = [
            { id: 'b1', title: "Don Quixote", author: "Miguel de Cervantes", status: "Tersedia", stock: 2 },
            { id: 'b2', title: "Thinking Fast and Slow", author: "Daniel Kahneman", status: "Tersedia", stock: 3 },
            { id: 'b3', title: "To Kill a Mockingbird", author: "Harper Lee", status: "Dipinjam", stock: 0 },
            { id: 'b4', title: "Atomic Habits", author: "James Clear", status: "Tersedia", stock: 1 },
            { id: 'b5', title: "Harry Potter and the Sorcerer's Stone", author: "J.K. Rowling", status: "Tersedia", stock: 2 },
            { id: 'b6', title: "Negeri 5 Menara", author: "Ahmad Fuadi", status: "Tersedia", stock: 1 },
            { id: 'b7', title: "Laskar Pelangi", author: "Andrea Hirata", status: "Dipinjam", stock: 0 },
            { id: 'b8', title: "Laut Bercerita", author: "Leila S. Chudori", status: "Tersedia", stock: 3 },
            { id: 'b9', title: "Max Havelaar", author: "Multatuli", status: "Tersedia", stock: 1 },
            { id: 'b10', title: "The Secret History of the World", author: "Jonathan Black", status: "Tersedia", stock: 2 },
            { id: 'b11', title: "Sapiens: A Brief History of Humankind", author: "Yuval Noah Harari", status: "Tersedia", stock: 2 },
            { id: 'b12', title: "Filosofi Teras", author: "Henry Manampiring", status: "Dipinjam", stock: 0 },
            { id: 'b13', title: "Bumi Manusia", author: "Pramoedya Ananta Toer", status: "Tersedia", stock: 1 },
            { id: 'b14', title: "Cantik Itu Luka", author: "Eka Kurniawan", status: "Tersedia", stock: 1 },
            { id: 'b15', title: "Rich Dad Poor Dad", author: "Robert T. Kiyosaki", status: "Tersedia", stock: 2 },
        ];

        // Dummy data for rooms AVAILABLE FOR BORROWING (NO descriptions here as per user request)
        const dummyRooms = [
            { id: 'r1', name: "Ruang Produksi Video", price: "Gratis", availability: "Tersedia", isPaid: false },
            { id: 'r2', name: "Ruang Produksi Podcast", price: "Gratis", availability: "Tersedia", isPaid: false },
            { id: 'r3', name: "Auditorium", price: "Rp 500.000 / Jam", availability: "Tersedia (Perlu Reservasi)", isPaid: true, basePricePerHour: 500000 }
        ];

        // Dummy data for trainings with quota information (Max 20 total quota)
        const dummyTrainings = [
            { id: 't1', name: "Pelatihan Kewirausahaan", target: "masyarakat umum", schedule: "setiap hari Sabtu, 08:00 WIB", totalQuota: 15, filledQuota: 12 },
            { id: 't2', name: "Pelatihan Literasi Digital & Informasi", target: "siswa dan mahasiswa", schedule: "setiap Selasa, 16:00 WIB", totalQuota: 20, filledQuota: 18 },
            { id: 't3', name: "Pelatihan Penggunaan Software", target: "siswa dan mahasiswa", schedule: "setiap Rabu, 16:00 WIB", totalQuota: 18, filledQuota: 18 }, // Penuh
            { id: 't4', name: "Pelatihan Desain Pembelajaran", target: "guru dan dosen", schedule: "setiap Minggu, 08:00 WIB", totalQuota: 10, filledQuota: 5 }
        ];

        // Check login status on page load
        let loggedInUser = JSON.parse(localStorage.getItem('loggedInUser'));
        updateAuthUI();

        function updateAuthUI() {
            const loginButton = document.getElementById('loginButton');
            const welcomeArea = document.getElementById('welcomeArea');
            const welcomeMessageSpan = document.getElementById('welcomeMessage');

            if (loggedInUser) {
                loginButton.classList.add('hidden');
                welcomeArea.classList.remove('hidden');
                welcomeArea.classList.add('flex'); // Ensure it's flex for display
                welcomeMessageSpan.textContent = loggedInUser.username;
            } else {
                loginButton.classList.remove('hidden');
                welcomeArea.classList.add('hidden');
                welcomeArea.classList.remove('flex');
                welcomeMessageSpan.textContent = '';
            }
        }

        function logout() {
            localStorage.removeItem('loggedInUser');
            loggedInUser = null;
            updateAuthUI();
            alert('Anda telah berhasil keluar.');
            window.location.href = 'index.html'; 
        }

        // Mobile Menu Toggle
        const mobileMenuButton = document.getElementById('mobileMenuButton');
        const mobileMenu = document.getElementById('mobileMenu');
        const closeMobileMenuButton = document.getElementById('closeMobileMenuButton');

        mobileMenuButton.addEventListener('click', () => {
            mobileMenu.classList.remove('hidden');
            document.body.style.overflow = 'hidden'; // Prevent scrolling
        });

        closeMobileMenuButton.addEventListener('click', () => {
            mobileMenu.classList.add('hidden');
            document.body.style.overflow = 'auto'; // Allow scrolling
        });

        // Close mobile menu when a link is clicked
        mobileMenu.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', () => {
                mobileMenu.classList.add('hidden');
                document.body.style.overflow = 'auto';
            });
        });

        // --- Service Modals ---
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        function openNotLoggedInModal() {
            openModal('notLoggedInModal');
        }

        function closeNotLoggedInModal() {
            closeModal('notLoggedInModal');
        }

        function goToLoginFromNotification() {
            closeNotLoggedInModal();
            window.location.href = 'login.html';
        }

        function handleServiceClick(serviceType, selectedItemId = null) {
            if (!loggedInUser) {
                openNotLoggedInModal();
                return;
            }
            openServiceModal(serviceType, selectedItemId);
        }

        function openServiceModal(serviceType, selectedItemId = null) {
            const modalTitle = document.getElementById('serviceModalTitle');
            const modalContent = document.getElementById('serviceModalContent');
            const serviceModalForm = document.getElementById('serviceModalForm');
            const confirmationMessage = document.getElementById('confirmationMessage');
            const additionalFields = document.getElementById('additionalServiceFormFields');

            // Reset modal state
            modalContent.innerHTML = '';
            additionalFields.innerHTML = '';
            serviceModalForm.classList.remove('hidden');
            confirmationMessage.classList.add('hidden');

            // Pre-fill user info
            document.getElementById('formName').value = loggedInUser.username;
            document.getElementById('formMemberId').value = loggedInUser.memberId;

            if (serviceType === 'pinjamRuangan') {
                modalTitle.textContent = 'Peminjaman Ruangan';
                let contentHtml = '<p class="mb-4 text-left">Berikut daftar ruangan yang bisa dipinjam:</p><div class="grid grid-cols-1 gap-4">';
                
                dummyRooms.forEach(room => {
                    contentHtml += `
                        <div class="bg-secondary p-4 rounded-lg border border-gray-200 text-left">
                            <h3 class="text-xl font-bold text-primary mb-2">${room.name} <span class="text-accent font-normal text-base">(${room.price})</span></h3>
                            <p class="text-medium-gray text-sm">Status: <span class="font-semibold ${room.availability.includes('Tersedia') ? 'text-green-600' : 'text-red-600'}">${room.availability}</span></p>
                            <p class="text-medium-gray text-sm mt-1">Sistem Ketersediaan: Mohon hubungi kami untuk info ketersediaan slot waktu dan reservasi.</p>
                        </div>
                    `;
                });
                contentHtml += '</div><p class="mt-6 text-medium-gray text-sm text-left">Untuk mengajukan peminjaman, silakan isi form di bawah.</p>';
                modalContent.innerHTML = contentHtml;

                additionalFields.innerHTML = `
                    <div>
                        <label class="block text-sm font-medium text-dark-gray">Pilih Ruangan</label>
                        <select id="selectedRoom" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm" required onchange="handleRoomSelection(this.value)">
                            <option value="">-- Pilih Ruangan --</option>
                            ${dummyRooms.map(room => `<option value="${room.id}" ${selectedItemId === room.id ? 'selected' : ''}>${room.name} (${room.price}) - ${room.availability}</option>`).join('')}
                        </select>
                    </div>
                    <div id="roomDateTimeWrapper">
                        <label class="block text-sm font-medium text-dark-gray">Tanggal & Waktu Peminjaman</label>
                        <input type="datetime-local" id="roomDateTime" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm" required />
                    </div>
                    <div id="auditoriumPaymentFields" class="hidden">
                        <label class="block text-sm font-medium text-dark-gray">Durasi Peminjaman (Jam)</label>
                        <input type="number" id="durationHours" min="1" value="1" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm" oninput="calculateAuditoriumCost()" />
                        <p class="text-sm text-medium-gray mt-2">Estimasi Biaya: <span id="estimatedCost" class="font-semibold text-primary">Rp 0</span></p>
                    </div>
                `;
                if (selectedItemId) {
                    handleRoomSelection(selectedItemId);
                }

            } else if (serviceType === 'pinjamBuku') {
                modalTitle.textContent = 'Peminjaman Buku';
                let contentHtml = '<p class="mb-4 text-left">Berikut koleksi buku yang tersedia di perpustakaan kami. Anda dapat meminjam hingga 3 buku:</p><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">';
                
                dummyBooks.forEach(book => {
                    contentHtml += `
                        <div class="bg-secondary p-4 rounded-lg shadow-sm border border-gray-200 text-left">
                            <h3 class="text-lg font-bold text-primary">${book.title}</h3>
                            <p class="text-medium-gray text-sm">Oleh: ${book.author}</p>
                            <p class="text-sm mt-2">Status: <span class="font-semibold ${book.status === 'Tersedia' ? 'text-green-600' : 'text-red-600'}">${book.status} ${book.status === 'Tersedia' ? `(${book.stock} tersedia)` : ''}</span></p>
                        </div>
                    `;
                });
                contentHtml += '</div><p class="mt-6 text-medium-gray text-sm text-left">Pilih buku yang ingin Anda pinjam (maksimal 3 buku) di bawah ini:</p>';
                modalContent.innerHTML = contentHtml;

                additionalFields.innerHTML = `
                    <div id="bookSelectionCheckboxes" class="space-y-2">
                        ${dummyBooks.map(book => `
                            <label class="inline-flex items-center">
                                <input type="checkbox" name="selectedBooks" value="${book.id}" class="form-checkbox text-accent" ${book.status !== 'Tersedia' ? 'disabled' : ''}>
                                <span class="ml-2 text-medium-gray ${book.status !== 'Tersedia' ? 'line-through text-gray-500' : ''}">${book.title} - ${book.author} (${book.status})</span>
                            </label>
                        `).join('')}
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-dark-gray">Tanggal Pengembalian (Maks 7 hari dari sekarang)</label>
                        <input type="date" id="bookReturnDate" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm" required />
                    </div>
                `;

            } else if (serviceType === 'daftarPelatihan') {
                modalTitle.textContent = 'Daftar Pelatihan';
                let contentHtml = '<p class="mb-4 text-left">Berikut daftar pelatihan yang bisa Anda ikuti. Klik pada kotak pelatihan untuk mendaftar:</p><div class="grid grid-cols-1 md:grid-cols-2 gap-4">';
                
                dummyTrainings.forEach(training => {
                    const isFull = training.filledQuota >= training.totalQuota;
                    contentHtml += `
                        <div class="bg-secondary p-4 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition duration-300 ${isFull ? 'opacity-60 cursor-not-allowed' : ''}" 
                             onclick="if(!${isFull}){handleServiceClick('daftarPelatihan', '${training.id}')}">
                            <h3 class="text-xl font-bold text-primary mb-1">${training.name}</h3>
                            <p class="text-medium-gray text-sm mt-1"><i class="fas fa-users mr-2 text-accent"></i>Target Peserta: ${training.target}</p>
                            <p class="text-medium-gray text-sm"><i class="fas fa-calendar-alt mr-2 text-accent"></i>Jadwal: ${training.schedule}</p>
                            <p class="text-sm mt-2">Kuota: <span class="font-semibold ${isFull ? 'text-red-600' : 'text-green-600'}">${training.filledQuota}/${training.totalQuota}</span> ${isFull ? '(PENUH)' : ''}</p>
                        </div>
                    `;
                });
                contentHtml += '</div><p class="mt-6 text-medium-gray text-sm text-left">Untuk mendaftar, silakan isi form di bawah.</p>';
                modalContent.innerHTML = contentHtml;

                const selectedTraining = dummyTrainings.find(t => t.id === selectedItemId);
                additionalFields.innerHTML = `
                    <div>
                        <label class="block text-sm font-medium text-dark-gray">Pilih Pelatihan</label>
                        <select id="selectedTraining" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm" required>
                            <option value="">-- Pilih Pelatihan --</option>
                            ${dummyTrainings.map(training => `
                                <option value="${training.id}" ${selectedTraining && selectedTraining.id === training.id ? 'selected' : ''} ${training.filledQuota >= training.totalQuota ? 'disabled' : ''}>
                                    ${training.name} (${training.schedule}) - Kuota: ${training.filledQuota}/${training.totalQuota} ${training.filledQuota >= training.totalQuota ? '(PENUH)' : ''}
                                </option>
                            `).join('')}
                        </select>
                    </div>
                `;
            }

            openModal('serviceModal');
            document.getElementById('serviceSubmissionForm').dataset.serviceType = serviceType;
        }

        function closeServiceModal() {
            closeModal('serviceModal');
            document.getElementById('serviceSubmissionForm').reset();
            document.getElementById('confirmationMessage').classList.add('hidden');
            document.getElementById('serviceModalForm').classList.remove('hidden');
            document.getElementById('auditoriumPaymentFields').classList.add('hidden');
        }

        function handleRoomSelection(roomId) {
            const selectedRoom = dummyRooms.find(room => room.id === roomId);
            const auditoriumPaymentFields = document.getElementById('auditoriumPaymentFields');
            const roomDateTimeWrapper = document.getElementById('roomDateTimeWrapper');

            if (selectedRoom && selectedRoom.isPaid) {
                auditoriumPaymentFields.classList.remove('hidden');
                document.getElementById('durationHours').value = 1;
                calculateAuditoriumCost();
                roomDateTimeWrapper.classList.remove('hidden');
            } else {
                auditoriumPaymentFields.classList.add('hidden');
                roomDateTimeWrapper.classList.remove('hidden');
            }
        }

        function calculateAuditoriumCost() {
            const selectedRoomId = document.getElementById('selectedRoom').value;
            const selectedRoom = dummyRooms.find(room => room.id === selectedRoomId);
            const durationHours = parseInt(document.getElementById('durationHours').value) || 0;
            let estimatedCost = 0;

            if (selectedRoom && selectedRoom.isPaid) {
                estimatedCost = selectedRoom.basePricePerHour * durationHours;
            }
            document.getElementById('estimatedCost').textContent = `Rp ${estimatedCost.toLocaleString('id-ID')}`;
        }

        document.getElementById('serviceSubmissionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const serviceType = this.dataset.serviceType;
            const name = document.getElementById('formName').value;
            const memberId = document.getElementById('formMemberId').value;
            let confirmationDetail = '';

            if (serviceType === 'pinjamRuangan') {
                const selectedRoomId = document.getElementById('selectedRoom').value;
                const selectedRoom = dummyRooms.find(room => room.id === selectedRoomId);
                const roomDateTime = document.getElementById('roomDateTime').value;
                let costInfo = '';

                if (selectedRoom && selectedRoom.isPaid) {
                    const durationHours = parseInt(document.getElementById('durationHours').value) || 0;
                    const estimatedCost = selectedRoom.basePricePerHour * durationHours;
                    costInfo = ` dengan estimasi biaya Rp ${estimatedCost.toLocaleString('id-ID')}`;
                }
                confirmationDetail = `Permohonan peminjaman **${selectedRoom ? selectedRoom.name : 'Ruangan Tidak Dikenal'}** oleh **${name} (No. Anggota: ${memberId})** pada tanggal **${new Date(roomDateTime).toLocaleString('id-ID')}**${costInfo} berhasil diajukan.`;
            } else if (serviceType === 'pinjamBuku') {
                const selectedBookCheckboxes = Array.from(document.querySelectorAll('input[name="selectedBooks"]:checked'));
                if (selectedBookCheckboxes.length === 0) {
                    alert('Mohon pilih setidaknya satu buku.');
                    return;
                }
                if (selectedBookCheckboxes.length > 3) {
                    alert('Anda hanya bisa meminjam maksimal 3 buku.');
                    return;
                }
                const selectedBookIds = selectedBookCheckboxes.map(cb => cb.value);
                const selectedBooksTitles = selectedBookIds.map(id => dummyBooks.find(book => book.id === id).title).join(', ');
                const bookReturnDate = document.getElementById('bookReturnDate').value;

                selectedBookIds.forEach(id => {
                    const book = dummyBooks.find(b => b.id === id);
                    if (book && book.stock > 0) {
                        book.stock--;
                        if (book.stock === 0) {
                            book.status = 'Dipinjam';
                        }
                    }
                });

                confirmationDetail = `Permohonan peminjaman buku **"${selectedBooksTitles}"** oleh **${name} (No. Anggota: ${memberId})** berhasil diajukan. Mohon kembalikan sebelum tanggal **${new Date(bookReturnDate).toLocaleDateString('id-ID')}**.`;
            } else if (serviceType === 'daftarPelatihan') {
                const selectedTrainingId = document.getElementById('selectedTraining').value;
                const selectedTraining = dummyTrainings.find(t => t.id === selectedTrainingId);
                
                if (selectedTraining && selectedTraining.filledQuota < selectedTraining.totalQuota) {
                    selectedTraining.filledQuota++;
                } else if (selectedTraining && selectedTraining.filledQuota >= selectedTraining.totalQuota) {
                    alert('Maaf, kuota pelatihan ini sudah penuh.');
                    return;
                }

                confirmationDetail = `Pendaftaran pelatihan **${selectedTraining ? selectedTraining.name : 'Pelatihan Tidak Dikenal'}** oleh **${name} (No. Anggota: ${memberId})** berhasil. Detail lebih lanjut akan dikirim ke email Anda.`;
            }

            document.getElementById('serviceModalForm').classList.add('hidden');
            document.getElementById('confirmationDetail').innerHTML = confirmationDetail;
            document.getElementById('confirmationMessage').classList.remove('hidden');
        });
    </script>
</body>
</html>
